# Task Solution

This repository contains a solution of the recruitment task.

An original [yolov5](https://github.com/ultralytics/yolov5) repository has been forked in order to get pretrained object detection model and pipeline.
It has been modified by adding a subpackage `<repo_root>/task_solution/` that introduce implementation of the simple profiling system.
Moreover the `<repo_root>/detect.py` file containing inference pipeline has been modified in order to use implemented profiling system.

### Setup

Use python 3.11.5 (can be installed with [pyenv](https://github.com/pyenv/pyenv))

```bash
git clone https://github.com/JanKapala/yolov5
cd yolov5
python -m venv .
source bin/activate
python -m pip install -r requirements.txt
```

> WARNING! Task solution (profiling related stuff) uses 
> **only Python and PyTorch 2.x** as requested, however original `yolov5` code 
> uses other libraries hence the need for installation of packages from the 
> `requirements.txt` file.
> 
> Additionally, profiling code uses following built-in 
> packages from the python standard library:
> - `os`          - for files related stuff.
> - `time `       - for profiling
> - `datetime`    - for profiling
> - `typing`      - for type hints
> - `functools`   - for convenient statements profiling
> - `defaultdict` - for profiling results aggregation
> - `contextlib`  - for convenient statements profiling
> - `pprint`      - for better console printing
> - `logging`     - for elegant handling of console and file logs in parallel.

### How to run
In the `yolov5` repo root dir (inside the created virtual env) execute the 
following command to launch the profiling:
```bash
PYTHONPATH="${PYTHONPATH}:$(pwd)" python task_solution/main.py
```

The following new artifacts will be available when the script is finished:
- performance logs (per image, device and run) in the `./task_solution/performance_logs` dir.
- predictions in the `./task_solution/predictions` dir. 
- downloaded YOLOv5 model in the `./task_solution/yolov5s.pt` file.

> WARNING!!! Artifacts generated by me are already present in those directories 
> but when you run the profiling the new ones will be created.

### Grading tips:
Only following files are important for grading:
- `./task_solution/profiler.py` - implementation of the very simple profiler.
- `./task_solution/main.py` - code that launch profiling
- `./task_solution/dataset` and `./task_solution/predictions` contain examples and model predictions respectively.
- `./task_solution/performance_logs` dir contains logs from the profiler.
- `./detect.py` contains inference pipeline. This file has been modified by adding profiling statements in order to measure execution times of proper operations.